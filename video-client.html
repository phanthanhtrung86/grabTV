
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/html">
<head>
    <meta charset="utf-8">
    

    <link href="css/modern.css" rel="stylesheet">
    <link href="css/theme-dark.css" rel="stylesheet">
    <link href="css/modern-responsive.css" rel="stylesheet">

    <script src="public/js/assets/jquery-1.8.2.min.js"></script>
    <script src="public/js/assets/google-analytics.js"></script>
    <script src="public/js/assets/jquery.mousewheel.min.js"></script>
    <script src="public/js/assets/github.info.js"></script>
    <script src="public/js/modern/tile-slider.js"></script>
    <script src="public/js/modern/tile-drag.js"></script>

	<link href="css/generic.css" rel="stylesheet" type="text/css" />
    <link href="css/slider.css" rel="stylesheet" type="text/css" />
    <script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>
    <script src="js/jquery-slider.js" type="text/javascript"></script>
	
	
	
    <title>Modern UI CSS</title>

    <style>
        body {
            background: #1d1d1d;
        }
    </style>

    <script>
        function Resize(){
            var tiles_area = 0;
            $(".tile-group").each(function(){
                tiles_area += $(this).outerWidth() + 80;

            });

            $(".tiles").css("width", 120 + tiles_area + 20);

            $(".page").css({
                height: $(document).height() - 20,
                width: $(document).width()
            });
        }

        function AddMouseWheel(){
            $("body").mousewheel(function(event, delta){
                var scroll_value = delta * 50;
                if (jQuery.browser.webkit) {
                    this.scrollLeft -= scroll_value;
                } else {
                    document.documentElement.scrollLeft -= scroll_value;
                }
                return false;
            });
        }

        $(function(){
            Resize();
            AddMouseWheel();
        })
    </script>
	
	
	
	<script>
		"use strict";
		var controller = null;
		var isAllReadyFlag=false;
		var threshold=400;
		var para="";
		window.onload = function() {

		var connection = new WebSocket('ws://localhost:8888');
		if (connection == null)
			alert("Message is sent null..."+connection);
		connection.onopen = function () {  
		};
		
		connection.onerror = function (error) {
			// just in there were some problems with conenction...
			alert("error.."+error.toString());
		};
		
		var video = $_("video");
		var userCount;
		video.addEventListener("timeupdate", function() {
		}, true);
		
		video.addEventListener("pause", function() {
		}, true);
		
		// Script to be run when the media actually has enough buffer
		video.addEventListener("canplay", function() {
			connection.send("canplay "+video.currentTime);
		}, true);
		var container = document.getElementById('myList');
	 
		connection.onmessage = function (message) {  
		
			var matches;
			matches = message.data.split(/\s/g);
			
			var new_element = document.createElement('li');
			var bg_color="bg-color-pinkDark fg-color-white";
			var img_src="images/timestamp_icon.jpg";
			switch (matches[0]){
				case "control":
					bg_color="bg-color-pink fg-color-white";
					var img_src="images/controller_icon.jpg";
					break;	
				case "userCount":
					bg_color="bg-color-blue fg-color-white";
					var img_src="images/count_icon.jpg";
					break;
				case "pause":
					bg_color="bg-color-red fg-color-white";
					var img_src="images/pause_icon.jpg";
					break;
				case "timestamp":
					bg_color="bg-color-green fg-color-white";
					var img_src="images/timestamp_icon.jpg";
					break;
				
			}
			
			
			
			
			
			var main_content=matches[1];
			
			switch (matches[0]){
				case "control":
					$_("#controller").innerHTML = matches[1];
					video.src = matches[1];
					video.load();
					progressUpdate(true);
					break;	
				case "userCount":
					userCount=parseInt(matches[1]);
					userCount=userCount-1;
					document.getElementById("userCount").innerHTML = userCount;
					break;
				case "pause":
					video.pause();
					video.currentTime = matches[1];
					break;
				case "summary":
					alert(matches)
					alert(matches[2])
					
					
					para = matches;
					document.getElementById("summary").innerHTML = matches[1];
					break;
				case "timestamp":
					//alert(""+matches[1]);
					var estimatedTimeOnMaster = (matches[1])*1000;
					//video.currentTime = estimatedTimeOnMaster;
					
					//estimatedTimeOnMaster=estimatedTimeOnMaster*1000;
					var curTime=video.currentTime*1000;
					//curTime=curTime*1000;
					if (Math.abs(estimatedTimeOnMaster-curTime)>threshold){
						video.currentTime = estimatedTimeOnMaster;
						main_content="Master:"+estimatedTimeOnMaster+" Cur:"+curTime+" Threshold: "+threshold +" NotSync - Sync";
					}else{
						main_content="Master:"+estimatedTimeOnMaster+" Cur:"+curTime+" Threshold: "+threshold +" Sync - Sync";
					}
					if (video.paused){
						video.play();
					}
					break;
			}
			new_element.setAttribute("class",bg_color);
			
			new_element.setAttribute("style","height:80px; width:100%;display:inline-block;");
			//list-style-type:none;
					
			var div1=document.createElement('div');
			div1.setAttribute("class","icon");
			var image1=document.createElement('img');
			image1.setAttribute("src",img_src);
			div1.appendChild(image1);
			
			var div2=document.createElement('div');
			div2.setAttribute("class","data");
			var header4=document.createElement('h4');
			header4.setAttribute("class","fg-color-white");
			
			header4.innerHTML=matches[0];
			div2.appendChild(header4);
			
			var para=document.createElement('p');
			para.innerHTML=main_content;
			div2.appendChild(para);
			
			
			new_element.appendChild(div1);
			new_element.appendChild(div2);
			new_element.setAttribute("float","left");
			
			container.insertBefore(new_element, container.firstChild);
		  };
	};
	function $_(sel) {
	  return document.querySelector(sel);
	}
</script>

</head>
<body class="modern-ui" onresize="Resize()">
<div class="page secondary fixed-header">
    <div class="page-header ">
        <div class="page-header-content">
            <div class="user-login">
                <a href="#">
                    <div class="name">
                        <span class="first-name">NGUYEN</span>
                        <span class="last-name">Steven</span>
                    </div>
                    <div class="avatar">
                        <img src="images/steven_avatar.jpg"/>
                    </div>
                </a>
            </div>

            <h1>Client</h1>
        </div>
    </div>

    <div class="page-region">
        <div class="page-region-content tiles">
            <div class="tile-group tile-drag">
				
			
				
			<div class="tile  bg-color-blueDark" style="height: 100%;width: 680px;">
                    <div class="tile-content">
                       
                        <h4><span>Current broadcasting channel </span></h4>
                        <h3><span id="controller">---</span></h3>
						<h4><p>Total User Count: <span id="userCount"></span></p></h4>
                    </div>
                </div>
                <div  style="width: 318px; height: 318px;"  class="tile video outline-color-green">   
                    <div >
                        <video style="width: 318px; height: 318px;"  id="video" src="videos/windowsill.mp4" controls="controls" autobuffer="true"></video>
                    </div>
                </div>
				
				
				<div id="detailinfo" class="tile double bg-color-green" style="width: 318px; height: 318px;" data-role="tile-slider" data-param-period="2000">
                    <div class="tile-content">
                        <h2 id="header2" >Channel Summary</h2>
                        <p id="summary" >
                            ----
                        </p>
                    </div>   
                </div>
	
	
				
	
	
				<div  class="tile double bg-color-orange" style="height:400px; width:700px;overflow:auto;">
                    <ul id="myList" class="listview" style="overflow:auto;">
                        
                    </ul>
                </div>
				
            </div>  
        </div>
    </div>
</div>
<a href='http://hit.ua/?x=19154' target='_blank'>
    <script language="javascript" type="text/javascript"><!--
    Cd=document;Cr="&"+Math.random();Cp="&s=1";
    Cd.cookie="b=b";if(Cd.cookie)Cp+="&c=1";
    Cp+="&t="+(new Date()).getTimezoneOffset();
    if(self!=top)Cp+="&f=1";
    //--></script>
    <script language="javascript1.1" type="text/javascript"><!--
    if(navigator.javaEnabled())Cp+="&j=1";
    //--></script>
    <script language="javascript1.2" type="text/javascript"><!--
    if(typeof(screen)!='undefined')Cp+="&w="+screen.width+"&h="+
            screen.height+"&d="+(screen.colorDepth?screen.colorDepth:screen.pixelDepth);
    //--></script>
    <script language="javascript" type="text/javascript"><!--
    Cd.write("<img src='http://c.hit.ua/hit?i=19154&g=0&x=2"+Cp+Cr+
            "&r="+escape(Cd.referrer)+"&u="+escape(window.location.href)+
            "' border='0' wi"+"dth='1' he"+"ight='1'/>");
    //--></script>
    <noscript>
        <img src='http://c.hit.ua/hit?i=19154&amp;g=0&amp;x=2' border='0'/>
    </noscript></a>
<!-- / hit.ua -->

</body>
</html>